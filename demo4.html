<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
    </style>

</head>


<body>
    <div class="test">
        下面是模型展示
        <div id="model" style="width:1000px;height:1000px;border: 1px solid #423442">

        </div>
    </div>
    <table id="__01" width="1524" height="897" border="0" cellpadding="0" cellspacing="0">
        <tr>
            <td>
                <img src="images/&#x8fdb;&#x6c14;&#x7cfb;&#x7edf;P8_01.png" width="956" height="415" alt=""></td>
            <td>
                <img src="images/&#x8fdb;&#x6c14;&#x7cfb;&#x7edf;P8_02.png" width="568" height="415" alt=""></td>
        </tr>
        <tr>
            <td>
                <img src="images/&#x8fdb;&#x6c14;&#x7cfb;&#x7edf;P8_03.png" width="956" height="482" alt=""></td>
            <td>
                <img src="images/&#x8fdb;&#x6c14;&#x7cfb;&#x7edf;P8_04.png" width="568" height="482" alt=""></td>
        </tr>
    </table>

    <script src="./js/three.js"></script>
    <script src="./js/OrbitControls.js"></script>
    <script src="./js/stats.min.js"></script>
    <script src="./js/dat.gui.min.js"></script>
    <script src="./js/NURBSCurve.js"></script>
    <script src="./js/NURBSUtils.js"></script>
    <script src="./js/FBXLoader.js"></script>
    <script src="./js/Detector.js"></script>
    <script src="./js/inflate.min.js"></script>
    <script>
        //渲染器
        var renderer;
        function initRender() {
            var targetDom = document.getElementById("model");
            console.log(targetDom);
            width = targetDom.clientWidth;
            height = targetDom.clientHeight;
            renderer = new THREE.WebGLRenderer({
                antialias: true
            });
            //设置canvas尺寸
            renderer.setSize(width, height);
            //设置背景
            renderer.setClearColor(0xffffff,1.0);
            //设置设备像素比
            renderer.setPixelRatio(window.devicePixelRatio);
            //添加到dom
            targetDom.appendChild(renderer.domElement);

        }

        //相机
        var camera;
        function initCamera() {
            camera = new THREE.PerspectiveCamera(45, document.getElementById("model").clientWidth / document.getElementById("model").clientHeight, 1, 2000);
            camera.position.set(100, 100, 100);
            // camera.lookAt(new THREE.Vector3(0,0,0));
        }
        //场景
        var scene;
        function initScene() {
            scene = new THREE.Scene();
			// scene.fog = new THREE.Fog( 0xa0a0a0, 4000, 6000 );
        }
        //光源
        var light,lightHelper;
        function initLight() {
            // 创建 环境光
            // var ambientLight = new THREE.AmbientLight(0x777777)
            // scene.add(ambientLight)
            //添加聚光灯
            var spotLight = new THREE.SpotLight(0xaaaaaa)
            spotLight.position.set(-100, 100, 100)
            scene.add(spotLight)

            // var light = new THREE.HemisphereLight( 0xffffff, 0x080820, 1 );
            // scene.add( light );

            var dirLight = new THREE.DirectionalLight(0xffffff, 1);
            dirLight.position.set(100, 100, 50);
            scene.add(dirLight);

            lightHelper = new THREE.SpotLightHelper( spotLight );
            scene.add( lightHelper );
        }
        //初始化性能插件
        var stats;
        function initStats() {
            stats = new Stats();
            document.body.appendChild(stats.dom);
        }

        var gui;
        function initGui() {
            //声明一个保存需求修改的相关数据的对象
            gui = {
                BallY:0, //灯光y轴的位置
                BallX:0, //球的x轴的位置
                BallZ:0, //球的z轴的位置
            };
            var datGui = new dat.GUI();
            //将设置属性添加到gui当中，gui.add(对象，属性，最小值，最大值）
            datGui.add(gui,"BallY",-1000,5000);
            datGui.add(gui,"BallX",-1000,5000);
            datGui.add(gui,"BallZ",-1000,5000);
        }
        var carmodel;
        //模型
        function initModel() {
            //轴辅助 （每一个轴的长度）
            // object = new THREE.AxesHelper(100);
            // scene.add(object);
            // 创建一个平面 PlaneGeometry(width, height, widthSegments, heightSegments)
            // var planeGeometry = new THREE.PlaneGeometry(100, 100, 1, 1);

            // // 创建 Lambert 材质：会对场景中的光源作出反应，但表现为暗淡，而不光亮。
            // var planeMaterial = new THREE.MeshLambertMaterial({
            //     color: 0xffffff
            // });

            // var plane = new THREE.Mesh(planeGeometry, planeMaterial);
            // plane.rotation.x = -0.5 * Math.PI;
            // scene.add(plane);
            
            // model
            var loader = new THREE.FBXLoader();
            loader.load( './fbx/min5.fbx', function( object ) {
                console.log("========================");
                carmodel = object;
                carmodel.scale.set(1,1,1);
                var box = new THREE.Box3();
                //通过传入的object3D对象来返回当前模型的最小大小，值可以使一个mesh也可以使group
                box.expandByObject(object);
                console.log(box);
                scene.add( carmodel );
            } );
        }

        function animate() {
            render();
            stats.update();
            // if(carmodel != undefined){
            //     carmodel.position.y = gui.BallY;
            //     carmodel.position.x = gui.BallX;
            //     carmodel.position.z = gui.BallZ;
            // }
            // camera.position.y = gui.BallY;
            // camera.position.x = gui.BallX;
            // camera.position.z = gui.BallZ;
            controls.update();
            requestAnimationFrame(animate);
        }

        function render() {
            renderer.render(scene, camera);
        }

        //窗口变动触发的函数
        function onWindowResize() {
            camera.aspect = document.getElementById("model").clientWidth / document.getElementById("model").clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(document.getElementById("model").clientWidth, document.getElementById("model").clientHeight);
        }

        //用户交互插件 鼠标左键按住旋转，右键按住平移，滚轮缩放
        var controls;
        function initControls() {
            controls = new THREE.OrbitControls( camera, renderer.domElement ); 
            // 如果使用animate方法时，将此函数删除
            //controls.addEventListener( 'change', render );
            // 使动画循环使用时阻尼或自转 意思是否有惯性
            controls.enableDamping = true;
            //动态阻尼系数 就是鼠标拖拽旋转灵敏度
            //controls.dampingFactor = 0.25;
            //是否可以缩放
            controls.enableZoom = true;
            //是否自动旋转
            controls.autoRotate = false;
            //设置相机距离原点的最远距离
            controls.minDistance  = 1;
            //设置相机距离原点的最远距离
            controls.maxDistance  = 3000;
            //是否开启右键拖拽
            controls.enablePan = true;
            

        }

        //绘制
        function draw() {
            //initGui();
            initRender();
            initCamera();
            initScene();
            initLight();
            initModel();
            initControls();
            initStats();
            
            animate();

            window.addEventListener('resize', onWindowResize, false);
            
        }
        draw();
    </script>
</body>

</html>